<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Pembantu Perancangan Modul Belajar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Menggunakan font Inter secara default, fallback ke sans-serif */
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-smoothing: grayscale;
            background-color: #f0fdf4; /* Warna latar belakang hijau pastel lembut */
            color: #262626; /* Warna teks dasar abu-abu gelap */
        }
        /* Mengatur agar area output Modul bisa di-scroll dan terlihat rapi */
        #moduleOutputContainer {
            min-height: 400px; /* Tinggi minimal untuk area output */
            font-family: 'Arial', sans-serif; /* Font umum untuk dokumen */
            font-size: 1rem; /* Ukuran font dasar */
            line-height: 1.6; /* Spasi baris untuk keterbacaan */
            overflow-y: auto; /* Agar bisa discroll jika konten panjang */
        }
        #moduleOutputContainer h1, #moduleOutputContainer h2 {
            font-weight: bold;
            margin-bottom: 0.75rem;
        }
        #moduleOutputContainer h1 {
            font-size: 1.6rem; /* Ukuran untuk judul utama Modul */
            text-align: center;
            color: #166534; /* Hijau gelap */
        }
        #moduleOutputContainer h2 {
            font-size: 1.35rem; /* Ukuran untuk sub-judul bagian */
            color: #047857; /* Teal gelap */
            margin-top: 1.75rem;
            border-bottom: 2px solid #a7f3d0; /* Garis bawah yang lebih tebal */
            padding-bottom: 0.4rem;
        }
        #moduleOutputContainer p, #moduleOutputContainer ul, #moduleOutputContainer ol, #moduleOutputContainer table {
            margin-bottom: 1rem;
        }
        #moduleOutputContainer ul, #moduleOutputContainer ol {
            padding-left: 1.8rem; /* Padding lebih besar */
        }
        #moduleOutputContainer table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        #moduleOutputContainer th, #moduleOutputContainer td {
            border: 1px solid #d1fae5; /* Border tabel lebih lembut */
            padding: 0.8rem; /* Padding tabel lebih besar */
            text-align: left;
        }
        #moduleOutputContainer th {
            background-color: #ecfdf5; /* Background header tabel lebih terang */
            font-weight: 700;
            color: #065f46;
        }

        /* Styling untuk mode cetak - disembunyikan karena fungsi cetak diganti unduh */
        @media print {
            body {
                background-color: white;
                margin: 0;
                padding: 0;
                font-size: 10pt;
                line-height: 1.4;
            }
            .hide-on-print {
                display: none !important;
            }
            .printable-area {
                width: 21cm;
                margin: 0 auto;
                padding: 2.5cm;
                box-sizing: border-box;
                font-family: 'Times New Roman', serif;
            }
            .printable-area h1 {
                font-size: 18pt;
                margin-bottom: 1em;
            }
            .printable-area h2 {
                font-size: 14pt;
                margin-top: 1.5em;
                margin-bottom: 0.5em;
                border-bottom: 1px solid #ccc;
                padding-bottom: 0.2em;
            }
            .printable-area p, .printable-area ul, .printable-area ol, .printable-area table {
                margin-bottom: 0.8em;
            }
            .printable-area ul, .printable-area ol {
                padding-left: 1.2em;
            }
        }

        /* Modal Styles */
        .api-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8); /* Lebih gelap */
            backdrop-filter: blur(8px); /* Lebih blur */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease-in-out, visibility 0.4s ease-in-out;
        }
        .api-modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        .modal-content-card {
            background-color: #ffffff;
            padding: 3rem; /* Padding lebih besar */
            border-radius: 1.25rem; /* Sudut sangat membulat */
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4); /* Bayangan lebih tebal dan dalam */
            width: 95%;
            max-width: 600px; /* Lebar maksimum lebih besar */
            text-align: center;
            transform: translateY(-50px); /* Efek masuk lebih dramatis */
            transition: transform 0.4s ease-in-out;
        }
        .api-modal-overlay.show .modal-content-card {
            transform: translateY(0);
        }
        .modal-content-card h2 {
            font-size: 2rem; /* Ukuran font lebih besar */
            font-weight: 900; /* Ekstra tebal */
            color: #059669; /* Emerald-600 */
            margin-bottom: 1.5rem;
        }
        .modal-content-card p {
            color: #4b5563; /* Gray-700 */
            margin-bottom: 2rem;
            line-height: 1.7;
        }
        .modal-content-card input[type="password"] {
            margin-bottom: 2rem;
            border: 1px solid #9ca3af;
            border-radius: 0.75rem; /* Lebih membulat */
            padding: 1rem 1.5rem; /* Padding lebih besar */
            width: 100%;
            font-size: 1.1rem;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }
        .modal-actions-group {
            display: flex;
            gap: 1.5rem; /* Jarak antar tombol lebih besar */
            justify-content: center;
            flex-wrap: wrap;
        }
        .modal-actions-group button {
            flex-grow: 1;
            padding: 1rem 2rem; /* Padding lebih besar */
            border-radius: 0.75rem;
            font-weight: 800; /* Lebih tebal */
            cursor: pointer;
            transition: all 0.25s ease-in-out; /* Transisi untuk semua properti */
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15); /* Bayangan tombol lebih tebal */
        }
        .modal-actions-group .btn-action-save {
            background-color: #059669; /* Emerald-600 */
            color: white;
        }
        .modal-actions-group .btn-action-save:hover {
            background-color: #047857; /* Emerald-700 */
            transform: translateY(-3px) scale(1.02); /* Efek angkat dan sedikit membesar */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        .modal-actions-group .btn-action-clear {
            background-color: #ef4444; /* Red-500 */
            color: white;
        }
        .modal-actions-group .btn-action-clear:hover {
            background-color: #dc2626; /* Red-600 */
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        .modal-actions-group .btn-action-close {
            background-color: #6b7280; /* Gray-500 */
            color: white;
        }
        .modal-actions-group .btn-action-close:hover {
            background-color: #4b5563; /* Gray-600 */
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        /* Settings Button Styles */
        #apiSettingsButton {
            position: static;
            width: fit-content;
            height: auto;
            padding: 0.75rem 1.5rem;
            margin-top: 1.5rem;
            margin-left: auto;
            margin-right: auto;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            background-color: #d1fae5; /* Hijau terang */
            color: #065f46; /* Hijau gelap */
            border: 1px solid #6ee7b7; /* Border hijau */
            border-radius: 0.75rem;
            font-size: 1rem;
            font-weight: 700;
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out, transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            z-index: 10;
            cursor: pointer;
        }
        #apiSettingsButton:hover {
            background-color: #a7f3d0; /* Hijau lebih gelap saat hover */
            color: #047857;
            transform: scale(1.04);
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }
        @media (min-width: 768px) {
            #apiSettingsButton {
                position: fixed;
                top: 1.8rem; /* Lebih ke bawah dari sebelumnya */
                right: 1.8rem; /* Lebih ke kiri dari sebelumnya */
                width: 3.5rem; /* Ukuran lebih besar */
                height: 3.5rem;
                padding: 0.7rem;
                background-color: #059669; /* Emerald-600 */
                color: white;
                border: none;
                border-radius: 50%;
                justify-content: center;
                box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
                z-index: 1002;
            }
            #apiSettingsButton:hover {
                background-color: #047857;
                transform: scale(1.1);
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.35);
            }
        }

        /* Notification Message Box */
        .notification-message {
            position: fixed;
            top: 2rem; /* Sedikit lebih ke bawah */
            left: 50%;
            transform: translateX(-50%);
            z-index: 1001;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2); /* Bayangan lebih jelas */
            max-width: 90%;
            padding: 1rem 2rem; /* Padding lebih besar */
            border-radius: 1rem; /* Sudut lebih membulat */
            font-size: 1rem; /* Ukuran font lebih besar */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }
        .notification-message.show {
            opacity: 1;
            visibility: visible;
        }
        .notification-success {
            background-color: #dcfce7; /* Green-100 */
            color: #166534; /* Green-800 */
            border: 1px solid #4ade80; /* Green-400 */
        }
        .notification-error {
            background-color: #fee2e2; /* Red-100 */
            color: #991b1b; /* Red-800 */
            border: 1px solid #fca5a5; /* Red-400 */
        }
        .required-field {
            border-color: #ef4444 !important; /* Merah untuk field wajib yang kosong */
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.3) !important; /* Glow merah */
        }
        .animate-pulse-light {
            animation: pulse-light 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse-light {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
    </style>
</head>
<body class="p-6 md:p-12">
    <div class="max-w-6xl mx-auto bg-white p-8 md:p-12 rounded-3xl shadow-2xl border border-emerald-200 relative">
        <button id="apiSettingsButton" class="hide-on-print">
            <svg class="w-7 h-7 hidden md:block" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 15.375a3.375 3.375 0 100-6.75 3.375 3.375 0 000 6.75z" />
                <path fill-rule="evenodd" d="M10.707 2.293a1 1 0 011.414 0l.478.478a.75.75 0 001.06 0l.478-.478a1 1 0 011.414 0l.478.478a.75.75 0 001.06 0l.478-.478a1 1 0 011.414 0l.293.293a1 1 0 010 1.414l-.478.478a.75.75 0 000 1.06l.478.478a1 1 0 010 1.414l-.293.293a1 1 0 01-1.414 0l-.478-.478a.75.75 0 00-1.06 0l-.478.478a1 1 0 01-1.414 0l-.478-.478a.75.75 0 00-1.06 0l-.478.478a1 1 0 01-1.414 0l-.293-.293a1 1 0 010-1.414l.478-.478a.75.75 0 000-1.06l-.478-.478a1 1 0 010-1.414l.293-.293zM12 18a6 6 0 100-12 6 6 0 000 12z" clip-rule="evenodd" />
            </svg>
            <span class="md:hidden">Kelola Kunci API</span>
        </button>
        <h1 class="text-3xl md:text-5xl font-extrabold text-center text-emerald-800 mb-8 leading-tight">
            Aplikasi Pembantu Perancangan (LKPD)
        </h1>
        <p class="text-center text-gray-700 mb-10 text-lg">
            Dirancang untuk membantu Anda menyusun materi pembelajaran dan aktivitas siswa yang terstruktur.
        </p>

        <div class="mb-10 p-7 bg-green-50 border border-emerald-200 rounded-2xl shadow-lg hide-on-print">
            <h2 class="text-2xl font-bold text-emerald-700 mb-6 border-b-2 border-emerald-300 pb-3">Informasi Modul Utama</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-7 mb-7">
                <div>
                    <label for="subjectField" class="block text-gray-800 font-semibold mb-2">Mata Ajar <span class="text-red-500">*</span></label>
                    <input type="text" id="subjectField" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-emerald-500 focus:border-emerald-500 shadow-sm" value="Ilmu Pengetahuan Alam" placeholder="Contoh: IPA, Sejarah">
                </div>
                <div>
                    <label for="gradeLevel" class="block text-gray-800 font-semibold mb-2">Jenjang Kelas <span class="text-red-500">*</span></label>
                    <input type="text" id="gradeLevel" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-emerald-500 focus:border-emerald-500 shadow-sm" value="SMP Kelas VII" placeholder="Contoh: SD Kelas 4, SMA Kelas XI">
                </div>
                <div>
                    <label for="learningPeriod" class="block text-gray-800 font-semibold mb-2">Periode Belajar <span class="text-red-500">*</span></label>
                    <input type="text" id="learningPeriod" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-emerald-500 focus:border-emerald-500 shadow-sm" value="Semester Genap" placeholder="Contoh: Semester Ganjil, Bab 3">
                </div>
                <div>
                    <label for="mainTopic" class="block text-gray-800 font-semibold mb-2">Topik Utama <span class="text-red-500">*</span></label>
                    <input type="text" id="mainTopic" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-emerald-500 focus:border-emerald-500 shadow-sm" value="Dinamika Tata Surya" placeholder="Contoh: Rantai Makanan, Revolusi Industri">
                </div>
                <div class="md:col-span-2">
                    <label for="instructorName" class="block text-gray-800 font-semibold mb-2">Nama Pengajar <span class="text-red-500">*</span></label>
                    <input type="text" id="instructorName" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-emerald-500 focus:border-emerald-500 shadow-sm" value="Ibu Ayu Lestari, M.Pd." placeholder="Contoh: Bapak Irfan Hadi, S.Kom.">
                </div>
            </div>

            <div class="mb-7">
                <label for="learningOutcomes" class="block text-gray-800 font-semibold mb-2">Capaian Pembelajaran (pisahkan dengan baris baru) <span class="text-red-500">*</span></label>
                <textarea id="learningOutcomes" rows="5" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-emerald-500 focus:border-emerald-500 shadow-sm" placeholder="Contoh:
- Siswa dapat mengidentifikasi jenis-jenis ekosistem.
- Siswa mampu menjelaskan proses fotosintesis.">Peserta didik dapat mengidentifikasi komponen utama sistem tata surya.
Peserta didik mampu menjelaskan pergerakan benda-benda langit.
Peserta didik dapat menganalisis fenomena alam yang terkait dengan tata surya.</textarea>
            </div>

            <div class="mb-7">
                <label for="introHook" class="block text-gray-800 font-semibold mb-2">Pengantar / Pancingan Minat <span class="text-red-500">*</span></label>
                <textarea id="introHook" rows="4" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-emerald-500 focus:border-emerald-500 shadow-sm" placeholder="Contoh: Bagaimana bintang-bintang bisa terlihat di malam hari?">Pernahkah kalian bertanya-tanya, bagaimana alam semesta kita bekerja? Dari bintang-bintang yang berkilauan hingga planet-planet yang berputar, semua memiliki cerita dan peran penting. Mari kita selami misteri tata surya bersama!</textarea>
            </div>

            <div class="mb-7">
                <label for="activityInstructions" class="block text-gray-800 font-semibold mb-2">Panduan Aktivitas (pisahkan dengan baris baru) <span class="text-red-500">*</span></label>
                <textarea id="activityInstructions" rows="5" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-emerald-500 focus:border-emerald-500 shadow-sm" placeholder="Contoh:
1. Baca materi dengan cermat.
2. Kerjakan tugas secara mandiri atau kelompok.">Bacalah bagian pengantar dengan teliti untuk mendapatkan gambaran umum.
Pelajari sumber belajar yang telah disediakan, baik buku maupun tautan digital.
Diskusikan setiap pertanyaan dan studi kasus dengan teman kelompokmu.
Isilah kolom jawaban dan lembar evaluasi diri dengan jujur.
Pastikan semua bagian terisi sebelum mengumpulkan modul ini.</textarea>
            </div>

            <div class="mb-7">
                <label for="coreActivityPrompt" class="block text-gray-800 font-semibold mb-2">Skenario Kegiatan Utama (Stimulus/Studi Kasus) <span class="text-red-500">*</span></label>
                <textarea id="coreActivityPrompt" rows="5" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-emerald-500 focus:border-emerald-500 shadow-sm" placeholder="Contoh: Anda adalah seorang penjelajah angkasa. Tugas Anda adalah...">Skenario: Sebuah misi antariksa yang sedang memetakan planet ekstrasurya menemukan anomali gravitasi di sebuah sistem bintang ganda. Data awal menunjukkan kemungkinan keberadaan planet baru yang sangat besar. Jika Anda adalah kepala tim peneliti, strategi apa yang akan Anda rancang untuk mengonfirmasi keberadaan planet tersebut dan mengumpulkan informasi penting lainnya?</textarea>
            </div>

            <div class="mb-7">
                <label for="discussionQuestions" class="block text-gray-800 font-semibold mb-2">Pertanyaan Diskusi (pisahkan dengan baris baru) <span class="text-red-500">*</span></label>
                <textarea id="discussionQuestions" rows="6" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-emerald-500 focus:border-emerald-500 shadow-sm" placeholder="Contoh:
1. Apa saja perbedaan antara rotasi dan revolusi Bumi?
2. Jelaskan dampak perubahan iklim terhadap ekosistem laut.">Bagaimana interaksi gravitasi memengaruhi kestabilan orbit planet-planet di tata surya kita?
Mengapa para ilmuwan terus mencari planet mirip Bumi di zona habitasi bintang lain?
Bandingkan dan kontraskan model geosentris dan heliosentris tata surya. Faktor apa yang menyebabkan perubahan pemahaman ini?</textarea>
            </div>

            <div class="mb-7">
                <label for="studentReflection" class="block text-gray-800 font-semibold mb-2">Pertanyaan Refleksi Belajar Siswa (pisahkan dengan baris baru) <span class="text-red-500">*</span></label>
                <textarea id="studentReflection" rows="5" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-emerald-500 focus:border-emerald-500 shadow-sm" placeholder="Contoh:
1. Hal baru apa yang saya pelajari hari ini?
2. Konsep apa yang masih membingungkan bagi saya?">Apa konsep paling menarik yang saya pelajari tentang tata surya hari ini?
Bagian mana dari aktivitas ini yang membuat saya berpikir paling keras, dan mengapa?
Bagaimana pengetahuan baru ini dapat saya hubungkan dengan kehidupan sehari-hari atau berita terkini?</textarea>
            </div>

            <div class="mb-7">
                <label for="selfAssessmentStatements" class="block text-gray-800 font-semibold mb-2">Pernyataan Penilaian Mandiri (pisahkan dengan baris baru) <span class="text-red-500">*</span></label>
                <textarea id="selfAssessmentStatements" rows="4" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-emerald-500 focus:border-emerald-500 shadow-sm" placeholder="Contoh:
Saya memahami konsep dasar.
Saya dapat menyelesaikan tugas dengan bimbingan.">Saya dapat mengidentifikasi anggota sistem tata surya.
Saya mampu menjelaskan teori terbentuknya tata surya.
Saya bisa membedakan antara komet, asteroid, dan meteoroid.</textarea>
            </div>

            <div class="mb-7">
                <label for="moduleSummary" class="block text-gray-800 font-semibold mb-2">Rangkuman Materi <span class="text-red-500">*</span></label>
                <textarea id="moduleSummary" rows="4" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-emerald-500 focus:border-emerald-500 shadow-sm" placeholder="Contoh: Modul ini menjelaskan tentang...">Modul ini telah membahas tentang keajaiban sistem tata surya, dari komponen-komponennya hingga dinamika pergerakannya. Pemahaman ini penting untuk mengapresiasi kompleksitas alam semesta dan peran kita di dalamnya.</textarea>
            </div>

            <div class="mb-7">
                <label for="followUpActivities" class="block text-gray-800 font-semibold mb-2">Aktivitas Lanjutan <span class="text-red-500">*</span></label>
                <textarea id="followUpActivities" rows="4" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-emerald-500 focus:border-emerald-500 shadow-sm" placeholder="Contoh: Buatlah poster tentang tata surya.">Carilah video dokumenter tentang penjelajahan luar angkasa dan buatlah ringkasan singkat tentang misi yang paling menarik perhatianmu. Presentasikan di kelas minggu depan.</textarea>
            </div>

            <div class="mb-7">
                <label for="studentNotesArea" class="block text-gray-800 font-semibold mb-2">Ruang Catatan Pribadi Siswa (Opsional)</label>
                <textarea id="studentNotesArea" rows="4" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-emerald-500 focus:border-emerald-500 shadow-sm" placeholder="Gunakan ruang ini untuk mencatat ide, pertanyaan, atau pemikiran lain terkait pembelajaran.">Ini adalah ruang bagi Anda untuk mencatat hal-hal penting, pertanyaan, atau ide-ide kreatif selama proses pembelajaran.</textarea>
            </div>

            <div class="flex flex-col sm:flex-row gap-5">
                <button id="generateModuleBtn" class="bg-emerald-600 hover:bg-emerald-700 text-white font-extrabold py-3.5 px-7 rounded-xl shadow-lg transition duration-200 ease-in-out transform hover:scale-105 flex-1 text-lg">
                    <span id="generateBtnText">Rancang Modul</span>
                    <span id="generateBtnSpinner" class="hidden animate-spin h-6 w-6 border-4 border-white border-t-transparent rounded-full ml-3"></span>
                </button>
                <button id="clearFormBtn" class="bg-gray-500 hover:bg-gray-600 text-white font-extrabold py-3.5 px-7 rounded-xl shadow-lg transition duration-200 ease-in-out transform hover:scale-105 flex-1 text-lg">
                    Bersihkan Formulir
                </button>
            </div>
        </div>

        <div class="mt-12 printable-area">
            <h2 class="text-2xl font-bold text-emerald-700 mb-6 text-center hide-on-print border-b-2 border-emerald-300 pb-3">Pratinjau Modul Pembelajaran Anda</h2>
            <div id="moduleOutputContainer" class="w-full p-6 border border-lime-300 rounded-xl bg-lime-50 text-gray-800 shadow-inner">
                <p class="text-center text-gray-500 italic">Silakan isi formulir di atas dan klik "Rancang Modul" untuk menghasilkan rancangan modul pembelajaran.</p>
            </div>

            <div class="flex justify-center mt-6 hide-on-print">
                <button id="downloadModuleBtn" class="bg-lime-600 hover:bg-lime-700 text-white font-bold py-3.5 px-7 rounded-xl shadow-lg transition duration-200 ease-in-out transform hover:scale-105 text-lg">
                    Unduh Modul Teks
                </button>
            </div>

            <p class="text-base text-gray-600 mt-6 text-center hide-on-print">
                Unduh file teks di atas, lalu buka dengan aplikasi pengolah kata (MS Word/Google Docs) untuk penyesuaian tata letak dan pencetakan optimal.
            </p>
        </div>
    </div>

    <div id="geminiApiModal" class="api-modal-overlay">
        <div class="modal-content-card">
            <h2>Konfigurasi Kunci API Gemini</h2>
            <p>
                Untuk memanfaatkan kapabilitas AI, Anda perlu memasukkan Kunci API Gemini Anda.
                Kunci ini akan disimpan secara lokal di browser Anda dan tidak akan dikirimkan ke server eksternal.
            </p>
            <input type="password" id="modalApiInput" placeholder="Contoh: AIzaSyC_..." class="focus:ring-emerald-400">
            <div class="modal-actions-group">
                <button id="saveApiBtn" class="btn-action-save">Simpan Kunci</button>
                <button id="clearApiBtn" class="btn-action-clear">Hapus Kunci</button>
                <button id="closeApiModalBtn" class="btn-action-close">Tutup</button>
            </div>
            <p class="mt-6 text-sm text-gray-600">
                <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener noreferrer" class="text-emerald-600 hover:underline font-semibold">Dapatkan Kunci API Gemini Anda di sini</a>
            </p>
        </div>
    </div>

    <script>
        // Mendapatkan referensi elemen-elemen DOM
        const geminiApiModal = document.getElementById('geminiApiModal');
        const modalApiInputElem = document.getElementById('modalApiInput');
        const saveApiBtn = document.getElementById('saveApiBtn');
        const clearApiBtn = document.getElementById('clearApiBtn');
        const closeApiModalBtn = document.getElementById('closeApiModalBtn');
        const apiSettingsButton = document.getElementById('apiSettingsButton');
        const moduleOutputContainer = document.getElementById('moduleOutputContainer');
        const generateModuleBtn = document.getElementById('generateModuleBtn');
        const clearFormBtn = document.getElementById('clearFormBtn');
        const downloadModuleBtn = document.getElementById('downloadModuleBtn');
        const generateBtnText = document.getElementById('generateBtnText');
        const generateBtnSpinner = document.getElementById('generateBtnSpinner');

        // Input fields
        const subjectFieldInput = document.getElementById('subjectField');
        const gradeLevelInput = document.getElementById('gradeLevel');
        const learningPeriodInput = document.getElementById('learningPeriod');
        const mainTopicInput = document.getElementById('mainTopic');
        const instructorNameInput = document.getElementById('instructorName');
        const learningOutcomesInput = document.getElementById('learningOutcomes');
        const introHookInput = document.getElementById('introHook');
        const activityInstructionsInput = document.getElementById('activityInstructions');
        const coreActivityPromptInput = document.getElementById('coreActivityPrompt');
        const discussionQuestionsInput = document.getElementById('discussionQuestions');
        const studentReflectionInput = document.getElementById('studentReflection');
        const selfAssessmentStatementsInput = document.getElementById('selfAssessmentStatements');
        const moduleSummaryInput = document.getElementById('moduleSummary');
        const followUpActivitiesInput = document.getElementById('followUpActivities');
        const studentNotesAreaInput = document.getElementById('studentNotesArea');

        /**
         * Menampilkan pesan notifikasi sementara di UI.
         * @param {string} message - Pesan yang akan ditampilkan.
         * @param {boolean} isError - True jika pesan adalah error, false jika sukses.
         */
        function showNotification(message, isError = false) {
            const container = document.querySelector('.max-w-6xl.mx-auto');
            let notificationDiv = container.querySelector('.notification-message');

            if (!notificationDiv) {
                notificationDiv = document.createElement('div');
                notificationDiv.className = `notification-message p-4 rounded-xl text-center text-base absolute top-8 left-1/2 -translate-x-1/2 w-3/4 z-20 shadow-lg`;
                container.insertBefore(notificationDiv, container.firstChild);
            }

            notificationDiv.textContent = message;
            notificationDiv.classList.remove('notification-success', 'notification-error', 'hidden', 'show');
            notificationDiv.classList.add(isError ? 'notification-error' : 'notification-success');
            notificationDiv.classList.add('show');

            setTimeout(() => {
                notificationDiv.classList.remove('show');
                setTimeout(() => notificationDiv.classList.add('hidden'), 400); // Penundaan untuk transisi
            }, 3500); // Durasi tampil pesan lebih lama
        }

        /**
         * Menyimpan Kunci API Gemini ke localStorage.
         */
        function storeApiKey() {
            const apiKey = modalApiInputElem.value.trim();
            if (apiKey) {
                localStorage.setItem('geminiApiKey', apiKey);
                geminiApiModal.classList.remove('show');
                showNotification('Kunci API Gemini berhasil disimpan.', false);
            } else {
                showNotification('Kunci API Gemini tidak boleh kosong.', true);
            }
        }

        /**
         * Menghapus Kunci API Gemini dari localStorage.
         */
        function removeApiKey() {
            localStorage.removeItem('geminiApiKey');
            modalApiInputElem.value = '';
            showNotification('Kunci API Gemini telah dihapus.', false);
        }

        /**
         * Mengatur status loading pada tombol dan spinner.
         * @param {boolean} isLoading - True untuk menampilkan loading, false untuk menyembunyikan.
         */
        function setLoadingState(isLoading) {
            if (isLoading) {
                generateBtnText.textContent = 'Membangun rancangan...';
                generateBtnSpinner.classList.remove('hidden');
                generateModuleBtn.disabled = true;
                clearFormBtn.disabled = true;
                downloadModuleBtn.disabled = true; // Disable download during generation
            } else {
                generateBtnText.textContent = 'Rancang Modul';
                generateBtnSpinner.classList.add('hidden');
                generateModuleBtn.disabled = false;
                clearFormBtn.disabled = false;
                downloadModuleBtn.disabled = false; // Enable download after generation
            }
        }

        /**
         * Mengambil data dari input form.
         * @returns {object} Objek berisi data modul belajar.
         */
        function getModuleData() {
            return {
                subjectField: subjectFieldInput.value.trim(),
                gradeLevel: gradeLevelInput.value.trim(),
                learningPeriod: learningPeriodInput.value.trim(),
                mainTopic: mainTopicInput.value.trim(),
                instructorName: instructorNameInput.value.trim(),
                learningOutcomes: learningOutcomesInput.value.trim().split('\n').filter(line => line.trim() !== ''),
                introHook: introHookInput.value.trim(),
                activityInstructions: activityInstructionsInput.value.trim().split('\n').filter(line => line.trim() !== ''),
                coreActivityPrompt: coreActivityPromptInput.value.trim(),
                discussionQuestions: discussionQuestionsInput.value.trim().split('\n').filter(line => line.trim() !== ''),
                studentReflection: studentReflectionInput.value.trim().split('\n').filter(line => line.trim() !== ''),
                selfAssessmentStatements: selfAssessmentStatementsInput.value.trim().split('\n').filter(line => line.trim() !== ''),
                moduleSummary: moduleSummaryInput.value.trim(),
                followUpActivities: followUpActivitiesInput.value.trim(),
                studentNotesArea: studentNotesAreaInput.value.trim() || 'Ini adalah ruang bagi Anda untuk mencatat hal-hal penting, pertanyaan, atau ide-ide kreatif selama proses pembelajaran.'
            };
        }

        /**
         * Validasi input form.
         * @param {object} data - Data modul belajar.
         * @returns {boolean} True jika semua input wajib terisi, false jika tidak.
         */
        function validateInputs(data) {
            const requiredInputs = [
                { id: 'subjectField', value: data.subjectField },
                { id: 'gradeLevel', value: data.gradeLevel },
                { id: 'learningPeriod', value: data.learningPeriod },
                { id: 'mainTopic', value: data.mainTopic },
                { id: 'instructorName', value: data.instructorName },
                { id: 'learningOutcomes', value: data.learningOutcomes },
                { id: 'introHook', value: data.introHook },
                { id: 'activityInstructions', value: data.activityInstructions },
                { id: 'coreActivityPrompt', value: data.coreActivityPrompt },
                { id: 'discussionQuestions', value: data.discussionQuestions },
                { id: 'studentReflection', value: data.studentReflection },
                { id: 'selfAssessmentStatements', value: data.selfAssessmentStatements },
                { id: 'moduleSummary', value: data.moduleSummary },
                { id: 'followUpActivities', value: data.followUpActivities }
            ];

            let allValid = true;
            requiredInputs.forEach(input => {
                const elem = document.getElementById(input.id);
                if (Array.isArray(input.value) ? input.value.length === 0 : !input.value) {
                    elem.classList.add('required-field');
                    allValid = false;
                } else {
                    elem.classList.remove('required-field');
                }
            });

            if (!allValid) {
                showNotification('Harap lengkapi semua bidang yang ditandai dengan (*).', true);
            }
            return allValid;
        }

        /**
         * Membangun prompt untuk Gemini API berdasarkan data modul.
         * @param {object} data - Data modul belajar.
         * @returns {string} Prompt yang diformat.
         */
        function constructGeminiPrompt(data) {
            const learningOutcomesList = data.learningOutcomes.map(item => `<li>${item.trim()}</li>`).join('\n');
            const instructionsList = data.activityInstructions.map(item => `<li>${item.trim()}</li>`).join('\n');
            const discussionQuestionsList = data.discussionQuestions.map((item, index) => `<li><strong>${index + 1}.</strong> ${item.trim()}
                <br><p class="text-sm text-gray-700 leading-tight">........................................................................................................................................................</p>
                <p class="text-sm text-gray-700 leading-tight">........................................................................................................................................................</p>
                </li>`).join('\n');
            const reflectionQuestionsList = data.studentReflection.map((item, index) => `<li><strong>${index + 1}.</strong> ${item.trim()}
                <br><p class="text-sm text-gray-700 leading-tight">........................................................................................................................................................</p>
                <p class="text-sm text-gray-700 leading-tight">........................................................................................................................................................</p>
                </li>`).join('\n');
            const selfAssessmentTableRows = data.selfAssessmentStatements.map(item => `
                <tr>
                    <td class="border border-gray-300 p-3">${item.trim()}</td>
                    <td class="border border-gray-300 p-3 text-center">☐ Ya</td>
                    <td class="border border-gray-300 p-3 text-center">☐ Tidak</td>
                </tr>`).join('\n');

            return `Buat fragmen HTML untuk Rancangan Modul Belajar Interaktif. Jangan sertakan tag HTML lengkap seperti <!DOCTYPE html>, <html>, <head>, atau <body>. HANYA hasilkan konten yang akan berada di dalam div 'moduleOutputContainer', menggunakan kelas Tailwind CSS dan struktur gaya yang mirip dengan contoh modul belajar. Pastikan untuk menyertakan ruang kosong untuk jawaban dan kotak centang untuk penilaian mandiri. Gunakan heading dan sub-heading yang jelas.

Berikut adalah detail modul:

<h1 class="text-2xl font-bold text-center mb-5">RANCANGAN MODUL BELAJAR INTERAKTIF</h1>
<hr class="border-t-2 border-emerald-300">
<h2 class="text-xl font-semibold mt-8 mb-4 border-b border-gray-300 pb-2">Detail Modul</h2>
<div class="mb-5 text-lg">
    <p><strong>Mata Ajar:</strong> ${data.subjectField}</p>
    <p><strong>Jenjang Kelas:</strong> ${data.gradeLevel}</p>
    <p><strong>Periode Belajar:</strong> ${data.learningPeriod}</p>
    <p><strong>Topik Utama:</strong> ${data.mainTopic}</p>
    <p><strong>Nama Pengajar:</strong> ${data.instructorName}</p>
</div>
<hr class="border-t-2 border-emerald-300">
<h2 class="text-xl font-semibold mt-8 mb-4 border-b border-gray-300 pb-2">Capaian Pembelajaran</h2>
<ul class="list-disc list-inside mb-5 text-lg leading-relaxed">
${learningOutcomesList}
</ul>
<hr class="border-t-2 border-emerald-300">
<h2 class="text-xl font-semibold mt-8 mb-4 border-b border-gray-300 pb-2">Pengantar & Pancingan Minat</h2>
<p class="mb-5 text-lg leading-relaxed">${data.introHook}</p>
<hr class="border-t-2 border-emerald-300">
<h2 class="text-xl font-semibold mt-8 mb-4 border-b border-gray-300 pb-2">Panduan Kegiatan</h2>
<ol class="list-decimal list-inside mb-5 text-lg leading-relaxed">
${instructionsList}
</ol>
<hr class="border-t-2 border-emerald-300">
<h2 class="text-xl font-semibold mt-8 mb-4 border-b border-gray-300 pb-2">Bagian Inti Aktivitas</h2>
<p class="mb-5 text-lg leading-relaxed">${data.coreActivityPrompt}</p>
<p class="text-sm text-gray-700 leading-tight">........................................................................................................................................................</p>
<p class="text-sm text-gray-700 leading-tight">........................................................................................................................................................</p>
<p class="text-sm text-gray-700 leading-tight">........................................................................................................................................................</p>
<p class="font-medium mb-3 text-lg">Diskusikan dan jawablah pertanyaan-pertanyaan ini:</p>
<ol class="list-decimal list-inside ml-5 mb-5 text-lg leading-relaxed">
${discussionQuestionsList}
</ol>
<hr class="border-t-2 border-emerald-300">
<h2 class="text-xl font-semibold mt-8 mb-4 border-b border-gray-300 pb-2">Refleksi Belajar</h2>
<ul class="list-none mb-5 text-lg leading-relaxed">
${reflectionQuestionsList}
</ul>
<hr class="border-t-2 border-emerald-300">
<h2 class="text-xl font-semibold mt-8 mb-4 border-b border-gray-300 pb-2">Penilaian Mandiri (Centang yang sesuai)</h2>
<table class="w-full border-collapse border border-gray-400 mb-5 text-lg">
    <thead>
        <tr>
            <th class="border border-gray-300 p-3 text-left bg-gray-100">Pernyataan</th>
            <th class="border border-gray-300 p-3 text-center bg-gray-100">Ya</th>
            <th class="border border-gray-300 p-3 text-center bg-gray-100">Tidak</th>
        </tr>
    </thead>
    <tbody>
${selfAssessmentTableRows}
    </tbody>
</table>
<hr class="border-t-2 border-emerald-300">
<h2 class="text-xl font-semibold mt-8 mb-4 border-b border-gray-300 pb-2">Rangkuman & Aktivitas Lanjutan</h2>
<p class="mb-5 text-lg leading-relaxed">${data.moduleSummary}</p>
<p class="mb-5 text-lg leading-relaxed"><strong>Aktivitas Lanjutan:</strong> ${data.followUpActivities}</p>
<hr class="border-t-2 border-emerald-300">
<h2 class="text-xl font-semibold mt-8 mb-4 border-b border-gray-300 pb-2">Ruang Catatan Pribadi Siswa</h2>
<p class="text-base italic text-gray-600 mb-3">${data.studentNotesArea}</p>
<p class="text-sm text-gray-700 leading-tight">........................................................................................................................................................</p>
<p class="text-sm text-gray-700 leading-tight">........................................................................................................................................................</p>
<p class="text-sm text-gray-700 leading-tight">........................................................................................................................................................</p>
<p class="text-sm text-gray-700 leading-tight">........................................................................................................................................................</p>
<p class="text-sm text-gray-700 leading-tight">........................................................................................................................................................</p>
`;
        }

        /**
         * Memanggil Gemini API untuk menghasilkan modul belajar.
         */
        async function generateLearningModule() {
            const apiKey = localStorage.getItem('geminiApiKey');
            if (!apiKey) {
                geminiApiModal.classList.add('show');
                showNotification('Kunci API Gemini tidak ditemukan. Harap masukkan kunci Anda.', true);
                return;
            }

            const moduleData = getModuleData();
            if (!validateInputs(moduleData)) {
                return; // Berhenti jika validasi gagal
            }

            setLoadingState(true);
            moduleOutputContainer.innerHTML = `<p class="text-center text-gray-600 italic animate-pulse-light">Sedang membangun rancangan modul Anda, mohon tunggu...</p>`;

            const prompt = constructGeminiPrompt(moduleData);

            try {
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const generatedHtml = result.candidates[0].content.parts[0].text;
                    moduleOutputContainer.innerHTML = generatedHtml;
                    showNotification('Rancangan modul berhasil dibuat!', false);
                } else {
                    moduleOutputContainer.innerHTML = `<p class="text-center text-red-600">Gagal membuat rancangan modul. Coba lagi atau periksa kunci API Anda.</p>`;
                    showNotification('Respons API tidak valid atau kosong.', true);
                }
            } catch (error) {
                console.error('Error fetching from Gemini API:', error);
                moduleOutputContainer.innerHTML = `<p class="text-center text-red-600">Terjadi kesalahan saat menghubungi API: ${error.message}.</p>`;
                showNotification('Terjadi kesalahan saat menghubungi API.', true);
            } finally {
                setLoadingState(false);
            }
        }

        /**
         * Mengatur ulang semua input formulir dan area output modul.
         */
        function resetForm() {
            subjectFieldInput.value = 'Ilmu Pengetahuan Alam';
            gradeLevelInput.value = 'SMP Kelas VII';
            learningPeriodInput.value = 'Semester Genap';
            mainTopicInput.value = 'Dinamika Tata Surya';
            instructorNameInput.value = 'Ibu Ayu Lestari, M.Pd.';
            learningOutcomesInput.value = `Peserta didik dapat mengidentifikasi komponen utama sistem tata surya.
Peserta didik mampu menjelaskan pergerakan benda-benda langit.
Peserta didik dapat menganalisis fenomena alam yang terkait dengan tata surya.`;
            introHookInput.value = `Pernahkah kalian bertanya-tanya, bagaimana alam semesta kita bekerja? Dari bintang-bintang yang berkilauan hingga planet-planet yang berputar, semua memiliki cerita dan peran penting. Mari kita selami misteri tata surya bersama!`;
            activityInstructionsInput.value = `Bacalah bagian pengantar dengan teliti untuk mendapatkan gambaran umum.
Pelajari sumber belajar yang telah disediakan, baik buku maupun tautan digital.
Diskusikan setiap pertanyaan dan studi kasus dengan teman kelompokmu.
Isilah kolom jawaban dan lembar evaluasi diri dengan jujur.
Pastikan semua bagian terisi sebelum mengumpulkan modul ini.`;
            coreActivityPromptInput.value = `Skenario: Sebuah misi antariksa yang sedang memetakan planet ekstrasurya menemukan anomali gravitasi di sebuah sistem bintang ganda. Data awal menunjukkan kemungkinan keberadaan planet baru yang sangat besar. Jika Anda adalah kepala tim peneliti, strategi apa yang akan Anda rancang untuk mengonfirmasi keberadaan planet tersebut dan mengumpulkan informasi penting lainnya?`;
            discussionQuestionsInput.value = `Bagaimana interaksi gravitasi memengaruhi kestabilan orbit planet-planet di tata surya kita?
Mengapa para ilmuwan terus mencari planet mirip Bumi di zona habitasi bintang lain?
Bandingkan dan kontraskan model geosentris dan heliosentris tata surya. Faktor apa yang menyebabkan perubahan pemahaman ini?`;
            studentReflectionInput.value = `Apa konsep paling menarik yang saya pelajari tentang tata surya hari ini?
Bagian mana dari aktivitas ini yang membuat saya berpikir paling keras, dan mengapa?
Bagaimana pengetahuan baru ini dapat saya hubungkan dengan kehidupan sehari-hari atau berita terkini?`;
            selfAssessmentStatementsInput.value = `Saya dapat mengidentifikasi anggota sistem tata surya.
Saya mampu menjelaskan teori terbentuknya tata surya.
Saya bisa membedakan antara komet, asteroid, dan meteoroid.`;
            moduleSummaryInput.value = `Modul ini telah membahas tentang keajaiban sistem tata surya, dari komponen-komponennya hingga dinamika pergerakannya. Pemahaman ini penting untuk mengapresiasi kompleksitas alam semesta dan peran kita di dalamnya.`;
            followUpActivitiesInput.value = `Carilah video dokumenter tentang penjelajahan luar angkasa dan buatlah ringkasan singkat tentang misi yang paling menarik perhatianmu. Presentasikan di kelas minggu depan.`;
            studentNotesAreaInput.value = `Ini adalah ruang bagi Anda untuk mencatat hal-hal penting, pertanyaan, atau ide-ide kreatif selama proses pembelajaran.`;

            // Hapus kelas 'required-field' dari semua input
            document.querySelectorAll('input, textarea').forEach(elem => {
                elem.classList.remove('required-field');
            });

            moduleOutputContainer.innerHTML = `<p class="text-center text-gray-500 italic">Silakan isi formulir di atas dan klik "Rancang Modul" untuk menghasilkan rancangan modul pembelajaran.</p>`;
            showNotification('Formulir berhasil direset.', false);
        }

        /**
         * Mengunduh konten dari moduleOutputContainer sebagai file teks.
         */
        function downloadModuleAsText() {
            const textContent = moduleOutputContainer.innerText;
            if (!textContent || textContent.includes('Silakan isi formulir')) {
                showNotification('Tidak ada modul untuk diunduh. Harap buat modul terlebih dahulu.', true);
                return;
            }
            const blob = new Blob([textContent], { type: 'text/plain;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'Rancangan_Modul_Belajar.txt';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showNotification('Modul berhasil diunduh sebagai file teks!', false);
        }


        // Inisialisasi utama setelah DOM dimuat sepenuhnya
        document.addEventListener('DOMContentLoaded', () => {
            // Setup API modal and event listeners
            const storedApiKey = localStorage.getItem('geminiApiKey');
            if (!storedApiKey || storedApiKey.trim() === '') {
                geminiApiModal.classList.add('show');
            }
            modalApiInputElem.value = storedApiKey || '';

            saveApiBtn.addEventListener('click', storeApiKey);
            clearApiBtn.addEventListener('click', removeApiKey);
            closeApiModalBtn.addEventListener('click', () => {
                geminiApiModal.classList.remove('show');
            });
            apiSettingsButton.addEventListener('click', () => {
                geminiApiModal.classList.add('show');
                modalApiInputElem.value = localStorage.getItem('geminiApiKey') || '';
            });

            // Event listeners for module generation and reset
            generateModuleBtn.addEventListener('click', generateLearningModule);
            clearFormBtn.addEventListener('click', resetForm);
            
            // Event listener for download button
            downloadModuleBtn.addEventListener('click', downloadModuleAsText);

            // Initial reset to populate default values and clear any previous state
            resetForm();
        });
    </script>
</body>
</html>
