<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asisten Pembuat Lembar Aktivitas Siswa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles untuk font Inter jika tersedia, fallback ke sans-serif */
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-smoothing: grayscale;
            background-color: #e6f7ff; /* Warna latar belakang biru pastel yang berbeda */
            color: #333; /* Warna teks dasar */
        }
        /* Mengatur agar area output LKPD bisa di-scroll dan terlihat rapi */
        #worksheetOutputContainer {
            min-height: 400px; /* Tinggi minimal untuk area output */
            font-family: 'Arial', sans-serif; /* Font umum untuk dokumen */
            font-size: 1rem; /* Ukuran font dasar */
            line-height: 1.6; /* Spasi baris untuk keterbacaan */
            overflow-y: auto; /* Agar bisa discroll jika konten panjang */
        }
        #worksheetOutputContainer h1, #worksheetOutputContainer h2 {
            font-weight: bold;
            margin-bottom: 0.75rem;
        }
        #worksheetOutputContainer h1 {
            font-size: 1.5rem; /* Ukuran untuk judul utama LKPD */
            text-align: center;
            color: #1a202c; /* Hampir hitam */
        }
        #worksheetOutputContainer h2 {
            font-size: 1.25rem; /* Ukuran untuk sub-judul bagian */
            color: #2c5282; /* Biru tua */
            margin-top: 1.5rem;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 0.25rem;
        }
        #worksheetOutputContainer p, #worksheetOutputContainer ul, #worksheetOutputContainer ol, #worksheetOutputContainer table {
            margin-bottom: 1rem;
        }
        #worksheetOutputContainer ul, #worksheetOutputContainer ol {
            padding-left: 1.5rem;
        }
        #worksheetOutputContainer table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        #worksheetOutputContainer th, #worksheetOutputContainer td {
            border: 1px solid #cbd5e0;
            padding: 0.75rem;
            text-align: left;
        }
        #worksheetOutputContainer th {
            background-color: #f0f4f8;
            font-weight: 600;
        }

        /* Styling untuk mode cetak */
        @media print {
            body {
                background-color: white; /* Hapus background di mode cetak */
                margin: 0; /* Hapus margin body */
                padding: 0;
                font-size: 10pt; /* Ukuran font lebih kecil untuk cetak */
                line-height: 1.4;
            }
            .hide-on-print {
                display: none !important; /* Sembunyikan elemen yang tidak perlu dicetak */
            }
            .printable-area {
                width: 21cm; /* Lebar A4 */
                /* height: 29.7cm; */ /* Tinggi A4 - remove fixed height for better content flow */
                margin: 0 auto; /* Tengah horizontal, hapus margin atas/bawah yang bisa konflik dengan padding */
                padding: 2.5cm; /* Margin 2.5 cm di semua sisi */
                box-sizing: border-box; /* Pastikan padding termasuk dalam lebar/tinggi */
                font-family: 'Times New Roman', serif; /* Font untuk cetak */
            }
            .printable-area h1 {
                font-size: 18pt;
                margin-bottom: 1em;
            }
            .printable-area h2 {
                font-size: 14pt;
                margin-top: 1.5em;
                margin-bottom: 0.5em;
                border-bottom: 1px solid #ccc;
                padding-bottom: 0.2em;
            }
            .printable-area p, .printable-area ul, .printable-area ol, .printable-area table {
                margin-bottom: 0.8em;
            }
            .printable-area ul, .printable-area ol {
                padding-left: 1.2em;
            }
        }

        /* Modal Styles */
        .api-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.75); /* Sedikit lebih gelap */
            backdrop-filter: blur(6px); /* Sedikit lebih blur */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }
        .api-modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        .modal-content-card {
            background-color: #ffffff;
            padding: 2.5rem; /* Padding sedikit lebih besar */
            border-radius: 1rem; /* Sudut lebih membulat */
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3); /* Bayangan lebih tebal */
            width: 95%;
            max-width: 550px; /* Lebar maksimum sedikit lebih besar */
            text-align: center;
            transform: translateY(-30px); /* Efek masuk sedikit lebih jauh */
            transition: transform 0.3s ease-in-out;
        }
        .api-modal-overlay.show .modal-content-card {
            transform: translateY(0);
        }
        .modal-content-card h2 {
            font-size: 1.75rem; /* Ukuran font lebih besar */
            font-weight: 800; /* Lebih tebal */
            color: #4f46e5; /* Indigo-600 */
            margin-bottom: 1.25rem;
        }
        .modal-content-card p {
            color: #6b7280; /* Gray-600 */
            margin-bottom: 1.75rem;
        }
        .modal-content-card input[type="password"] {
            margin-bottom: 1.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.625rem; /* Sedikit lebih membulat */
            padding: 0.875rem 1.25rem; /* Padding lebih besar */
            width: 100%;
            font-size: 1rem;
        }
        .modal-actions-group {
            display: flex;
            gap: 1.25rem; /* Jarak antar tombol lebih besar */
            justify-content: center;
            flex-wrap: wrap;
        }
        .modal-actions-group button {
            flex-grow: 1;
            padding: 0.875rem 1.75rem; /* Padding lebih besar */
            border-radius: 0.625rem;
            font-weight: 700; /* Lebih tebal */
            cursor: pointer;
            transition: all 0.2s ease-in-out; /* Transisi untuk semua properti */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Bayangan tombol */
        }
        .modal-actions-group .btn-action-save {
            background-color: #4f46e5; /* Indigo-600 */
            color: white;
        }
        .modal-actions-group .btn-action-save:hover {
            background-color: #4338ca; /* Indigo-700 */
            transform: translateY(-2px); /* Efek angkat */
        }
        .modal-actions-group .btn-action-clear {
            background-color: #ef4444; /* Rose-500 */
            color: white;
        }
        .modal-actions-group .btn-action-clear:hover {
            background-color: #dc2626; /* Rose-600 */
            transform: translateY(-2px);
        }
        .modal-actions-group .btn-action-close {
            background-color: #6b7280; /* Slate-500 */
            color: white;
        }
        .modal-actions-group .btn-action-close:hover {
            background-color: #4b5563; /* Slate-600 */
            transform: translateY(-2px);
        }

        /* Settings Button Styles */
        #settingsControlBtn {
            position: static;
            width: fit-content;
            height: auto;
            padding: 0.625rem 1.25rem;
            margin-top: 1.5rem;
            margin-left: auto;
            margin-right: auto;
            display: flex;
            align-items: center;
            gap: 0.625rem;
            background-color: #e0f2fe;
            color: #2563eb;
            border: 1px solid #93c5fd;
            border-radius: 0.625rem;
            font-size: 0.9rem;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out, transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            z-index: 10;
            cursor: pointer;
        }
        #settingsControlBtn:hover {
            background-color: #bfdbfe;
            color: #1e40af;
            transform: scale(1.03);
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
        }
        @media (min-width: 768px) {
            #settingsControlBtn {
                position: fixed;
                top: 1.5rem;
                right: 1.5rem;
                width: 3rem;
                height: 3rem;
                padding: 0.5rem;
                background-color: #4f46e5;
                color: white;
                border: none;
                border-radius: 50%;
                justify-content: center;
                box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
                z-index: 1002;
            }
            #settingsControlBtn:hover {
                background-color: #4338ca;
                transform: scale(1.08);
                box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            }
        }

        /* Notification Message Box */
        .notification-message {
            position: fixed;
            top: 1.5rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1001;
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
            max-width: 90%;
            padding: 0.8rem 1.5rem;
            border-radius: 0.75rem;
            font-size: 0.95rem;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }
        .notification-message.show {
            opacity: 1;
            visibility: visible;
        }
        .notification-success {
            background-color: #d1fae5;
            color: #065f46;
            border: 1px solid #6ee7b7;
        }
        .notification-error {
            background-color: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }
        .required-field {
            border-color: #ef4444 !important; /* Merah untuk field wajib yang kosong */
        }
        .animate-pulse-light {
            animation: pulse-light 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse-light {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
    </style>
</head>
<body class="p-5 md:p-10">
    <div class="max-w-5xl mx-auto bg-white p-8 md:p-10 rounded-2xl shadow-xl border border-indigo-200 relative">
        <button id="settingsControlBtn" class="hide-on-print">
            <svg class="w-6 h-6 hidden md:block" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 15.375a3.375 3.375 0 100-6.75 3.375 3.375 0 000 6.75z" />
                <path fill-rule="evenodd" d="M10.707 2.293a1 1 0 011.414 0l.478.478a.75.75 0 001.06 0l.478-.478a1 1 0 011.414 0l.478.478a.75.75 0 001.06 0l.478-.478a1 1 0 011.414 0l.293.293a1 1 0 010 1.414l-.478.478a.75.75 0 000 1.06l.478.478a1 1 0 010 1.414l-.293.293a1 1 0 01-1.414 0l-.478-.478a.75.75 0 00-1.06 0l-.478.478a1 1 0 01-1.414 0l-.478-.478a.75.75 0 00-1.06 0l-.478.478a1 1 0 01-1.414 0l-.293-.293a1 1 0 010-1.414l.478-.478a.75.75 0 000-1.06l-.478-.478a1 1 0 010-1.414l.293-.293zM12 18a6 6 0 100-12 6 6 0 000 12z" clip-rule="evenodd" />
            </svg>
            <span class="md:hidden">Kelola Kunci API</span>
        </button>
        <h1 class="text-3xl md:text-4xl font-extrabold text-center text-indigo-800 mb-7">Asisten Pembuat Lembar Aktivitas Siswa</h1>
        <p class="text-center text-gray-700 mb-9">Halaman ini menampilkan contoh Lembar Aktivitas Siswa (LKPD). Isi detail di bawah ini untuk membuat LKPD yang disesuaikan.</p>

        <div class="mb-8 p-6 bg-blue-50 border border-blue-200 rounded-xl shadow-md hide-on-print">
            <h2 class="text-2xl font-bold text-blue-700 mb-5">Detail LKPD</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div>
                    <label for="mataPelajaran" class="block text-gray-700 font-semibold mb-2">Mata Pelajaran <span class="text-red-500">*</span></label>
                    <input type="text" id="mataPelajaran" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-400 focus:border-blue-400" value="IPA" placeholder="Contoh: IPA, Matematika">
                </div>
                <div>
                    <label for="kelas" class="block text-gray-700 font-semibold mb-2">Kelas <span class="text-red-500">*</span></label>
                    <input type="text" id="kelas" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-400 focus:border-blue-400" value="VII" placeholder="Contoh: VII, X">
                </div>
                <div>
                    <label for="semester" class="block text-gray-700 font-semibold mb-2">Semester <span class="text-red-500">*</span></label>
                    <input type="text" id="semester" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-400 focus:border-blue-400" value="Genap" placeholder="Contoh: Ganjil, Genap">
                </div>
                <div>
                    <label for="materiPokok" class="block text-gray-700 font-semibold mb-2">Materi Pokok <span class="text-red-500">*</span></label>
                    <input type="text" id="materiPokok" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-400 focus:border-blue-400" value="Sistem Tata Surya" placeholder="Contoh: Sistem Tata Surya, Persamaan Linear">
                </div>
                <div class="md:col-span-2">
                    <label for="namaGuru" class="block text-gray-700 font-semibold mb-2">Nama Guru <span class="text-red-500">*</span></label>
                    <input type="text" id="namaGuru" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-400 focus:border-blue-400" value="Bpk. Budi Cahyadi, S.Pd." placeholder="Contoh: Ibu Siti Aminah, S.Pd.">
                </div>
            </div>

            <div class="mb-6">
                <label for="tujuanPembelajaran" class="block text-gray-700 font-semibold mb-2">Tujuan Pembelajaran (pisahkan dengan baris baru) <span class="text-red-500">*</span></label>
                <textarea id="tujuanPembelajaran" rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-400 focus:border-blue-400" placeholder="Contoh:
- Peserta didik dapat menjelaskan komponen-komponen sistem tata surya.
- Peserta didik mampu mengidentifikasi karakteristik masing-masing planet.">Peserta didik dapat menjelaskan komponen-komponen sistem tata surya dengan benar.
Peserta didik mampu mengidentifikasi karakteristik masing-masing planet dalam tata surya.
Peserta didik dapat menganalisis interaksi antaranggota sistem tata surya.</textarea>
            </div>

            <div class="mb-6">
                <label for="pengantarApersepsi" class="block text-gray-700 font-semibold mb-2">Pengantar / Apersepsi <span class="text-red-500">*</span></label>
                <textarea id="pengantarApersepsi" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-400 focus:border-blue-400" placeholder="Contoh: Pernahkah Anda melihat bintang di malam hari?">Pernahkah kamu melihat bintang-bintang di malam hari? Atau mengamati perubahan bentuk bulan? Bagaimana semua benda langit itu bisa bergerak teratur di alam semesta ini?</textarea>
            </div>

            <div class="mb-6">
                <label for="petunjukKerja" class="block text-gray-700 font-semibold mb-2">Petunjuk Kerja (pisahkan dengan baris baru) <span class="text-red-500">*</span></label>
                <textarea id="petunjukKerja" rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-400 focus:border-blue-400" placeholder="Contoh:
1. Bacalah materi dengan saksama.
2. Diskusikan setiap pertanyaan dengan kelompok.">Bacalah materi tentang sistem tata surya dengan saksama dari berbagai sumber.
Diskusikan setiap pertanyaan dan tugas dengan kelompokmu.
Tuliskan jawaban dan hasil diskusimu pada kolom yang disediakan.
Periksa kembali jawabanmu sebelum dikumpulkan.</textarea>
            </div>

            <div class="mb-6">
                <label for="kegiatanIntiPrompt" class="block text-gray-700 font-semibold mb-2">Prompt Kegiatan Inti (Studi Kasus/Pendahuluan) <span class="text-red-500">*</span></label>
                <textarea id="kegiatanIntiPrompt" rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-400 focus:border-blue-400" placeholder="Contoh: Bagian ini akan menguji pemahaman Anda. Studi Kasus: Bayangkan Anda adalah seorang ilmuwan...">Bagian ini akan menguji pemahaman Anda tentang sistem tata surya.
Studi Kasus: Bayangkan Anda adalah seorang astronom yang baru saja menemukan sebuah objek langit misterius di luar orbit Neptunus. Berdasarkan pengamatan awal, objek ini memiliki massa yang sangat besar dan orbit yang tidak biasa. Jelaskan langkah-langkah investigasi yang akan Anda lakukan untuk mengklasifikasikan objek ini, serta tantangan apa yang mungkin Anda hadapi.</textarea>
            </div>

            <div class="mb-6">
                <label for="pertanyaanInti" class="block text-gray-700 font-semibold mb-2">Pertanyaan Inti (pisahkan dengan baris baru) <span class="text-red-500">*</span></label>
                <textarea id="pertanyaanInti" rows="5" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-400 focus:border-blue-400" placeholder="Contoh:
1. Bagaimana fotosintesis bekerja?
2. Apa perbedaan antara sel hewan dan sel tumbuhan?">Bagaimana posisi bumi di tata surya memengaruhi kehidupan di dalamnya?
Mengapa Pluto tidak lagi diklasifikasikan sebagai planet? Jelaskan argumen ilmiah di baliknya.
Bandang dan jelaskan perbedaan antara komet dan asteroid dari segi komposisi, orbit, dan asal-usulnya.</textarea>
            </div>

            <div class="mb-6">
                <label for="refleksiSiswa" class="block text-gray-700 font-semibold mb-2">Pertanyaan Refleksi Diri Siswa (pisahkan dengan baris baru) <span class="text-red-500">*</span></label>
                <textarea id="refleksiSiswa" rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-400 focus:border-blue-400" placeholder="Contoh:
1. Apa yang saya pelajari hari ini?
2. Bagian mana yang sulit saya pahami?">Apa yang saya pelajari hari ini tentang sistem tata surya?
Bagian mana dari materi sistem tata surya yang paling saya pahami atau yang paling sulit saya pahami?
Apa yang ingin saya tanyakan lebih lanjut terkait materi sistem tata surya ini?</textarea>
            </div>

            <div class="mb-6">
                <label for="penilaianDiriPernyataan" class="block text-gray-700 font-semibold mb-2">Pernyataan Penilaian Diri (pisahkan dengan baris baru) <span class="text-red-500">*</span></label>
                <textarea id="penilaianDiriPernyataan" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-400 focus:border-blue-400" placeholder="Contoh:
Saya dapat menjelaskan konsep dasar.
Saya dapat menerapkan rumus yang dipelajari.">Saya dapat menjelaskan komponen-komponen sistem tata surya.
Saya mampu mengidentifikasi karakteristik setiap planet.
Saya dapat menganalisis interaksi antar anggota tata surya.</textarea>
            </div>

            <div class="mb-6">
                <label for="kesimpulan" class="block text-gray-700 font-semibold mb-2">Kesimpulan <span class="text-red-500">*</span></label>
                <textarea id="kesimpulan" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-400 focus:border-blue-400" placeholder="Contoh: Singkatnya, tata surya kita terdiri dari...">Sistem tata surya adalah kumpulan benda langit yang terdiri dari matahari sebagai pusat, planet-planet, asteroid, komet, dan benda langit lainnya yang mengelilinginya dalam orbit masing-masing. Memahami tata surya membantu kita mengapresiasi kompleksitas dan keteraturan alam semesta.</textarea>
            </div>

            <div class="mb-6">
                <label for="tugasTambahan" class="block text-gray-700 font-semibold mb-2">Tugas Tambahan <span class="text-red-500">*</span></label>
                <textarea id="tugasTambahan" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-400 focus:border-blue-400" placeholder="Contoh: Cari tahu lebih lanjut tentang bulan Jupiter.">Cari dan catatlah informasi menarik tentang salah satu penemuan terbaru di bidang astronomi terkait sistem tata surya, lalu presentasikan di kelas minggu depan.</textarea>
            </div>

            <div class="mb-6">
                <label for="ruangCatatan" class="block text-gray-700 font-semibold mb-2">Ruang Catatan Bebas Siswa (Opsional)</label>
                <textarea id="ruangCatatan" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-400 focus:border-blue-400" placeholder="Gunakan ruang ini untuk mencatat ide, pertanyaan, atau pemikiran lain terkait pembelajaran.">Gunakan ruang ini untuk mencatat ide, pertanyaan, atau pemikiran lain terkait pembelajaran.</textarea>
            </div>

            <div class="flex flex-col sm:flex-row gap-4">
                <button id="generateWorksheetBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg transition duration-200 ease-in-out transform hover:scale-105 flex-1">
                    <span id="generateBtnText">Buat LKPD</span>
                    <span id="generateBtnSpinner" class="hidden animate-spin h-5 w-5 border-4 border-white border-t-transparent rounded-full ml-2"></span>
                </button>
                <button id="resetFormBtn" class="bg-gray-400 hover:bg-gray-500 text-white font-bold py-3 px-6 rounded-xl shadow-lg transition duration-200 ease-in-out transform hover:scale-105 flex-1">
                    Reset Formulir
                </button>
            </div>
        </div>

        <div class="mt-10 printable-area">
            <h2 class="text-2xl font-semibold text-indigo-700 mb-5 text-center hide-on-print">Hasil Lembar Aktivitas Anda</h2>
            <div id="worksheetOutputContainer" class="w-full p-5 border border-teal-300 rounded-lg bg-teal-50 text-gray-800 shadow-inner">
                <p class="text-center text-gray-500 italic">Silakan isi formulir di atas dan klik "Buat LKPD" untuk menghasilkan lembar aktivitas.</p>
            </div>

            <div class="flex justify-center mt-5 hide-on-print">
                <button id="printWorksheetBtn" class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg transition duration-200 ease-in-out transform hover:scale-105">
                    Salin Teks LKPD
                </button>
            </div>

            <p class="text-sm text-gray-600 mt-5 text-center hide-on-print">
                Salin teks di atas, lalu tempel ke aplikasi pengolah kata (MS Word/Google Docs) untuk penyesuaian tata letak dan pencetakan optimal.
            </p>
        </div>
    </div>

    <div id="geminiApiModal" class="api-modal-overlay">
        <div class="modal-content-card">
            <h2>Konfigurasi Kunci API Gemini</h2>
            <p>
                Untuk memanfaatkan kapabilitas AI, Anda perlu memasukkan Kunci API Gemini Anda.
                Kunci ini akan disimpan secara lokal di browser Anda dan tidak akan dikirimkan ke server eksternal.
            </p>
            <input type="password" id="modalApiInput" placeholder="Contoh: AIzaSyC_..." class="focus:ring-2 focus:ring-indigo-300">
            <div class="modal-actions-group">
                <button id="saveApiBtn" class="btn-action-save">Simpan Kunci</button>
                <button id="clearApiBtn" class="btn-action-clear">Hapus Kunci</button>
                <button id="closeApiModalBtn" class="btn-action-close">Tutup</button>
            </div>
            <p class="mt-5 text-sm text-gray-500">
                <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener noreferrer" class="text-indigo-500 hover:underline">Dapatkan Kunci API Gemini Anda di sini</a>
            </p>
        </div>
    </div>

    <script>
        // Mendapatkan referensi elemen-elemen DOM
        const geminiApiModal = document.getElementById('geminiApiModal');
        const modalApiInputElem = document.getElementById('modalApiInput');
        const saveApiBtn = document.getElementById('saveApiBtn');
        const clearApiBtn = document.getElementById('clearApiBtn');
        const closeApiModalBtn = document.getElementById('closeApiModalBtn');
        const settingsControlBtn = document.getElementById('settingsControlBtn');
        const worksheetOutputContainer = document.getElementById('worksheetOutputContainer');
        const generateWorksheetBtn = document.getElementById('generateWorksheetBtn');
        const resetFormBtn = document.getElementById('resetFormBtn'); // FIXED: Changed 'resetForm' to 'resetFormBtn'
        const printWorksheetBtn = document.getElementById('printWorksheetBtn');
        const generateBtnText = document.getElementById('generateBtnText');
        const generateBtnSpinner = document.getElementById('generateBtnSpinner');

        // Input fields
        const mataPelajaranInput = document.getElementById('mataPelajaran');
        const kelasInput = document.getElementById('kelas');
        const semesterInput = document.getElementById('semester');
        const materiPokokInput = document.getElementById('materiPokok');
        const namaGuruInput = document.getElementById('namaGuru');
        const tujuanPembelajaranInput = document.getElementById('tujuanPembelajaran');
        const pengantarApersepsiInput = document.getElementById('pengantarApersepsi');
        const petunjukKerjaInput = document.getElementById('petunjukKerja');
        const kegiatanIntiPromptInput = document.getElementById('kegiatanIntiPrompt');
        const pertanyaanIntiInput = document.getElementById('pertanyaanInti');
        const refleksiSiswaInput = document.getElementById('refleksiSiswa');
        const penilaianDiriPernyataanInput = document.getElementById('penilaianDiriPernyataan');
        const kesimpulanInput = document.getElementById('kesimpulan');
        const tugasTambahanInput = document.getElementById('tugasTambahan');
        const ruangCatatanInput = document.getElementById('ruangCatatan');

        /**
         * Menampilkan pesan notifikasi sementara di UI.
         * @param {string} message - Pesan yang akan ditampilkan.
         * @param {boolean} isError - True jika pesan adalah error, false jika sukses.
         */
        function displayNotificationMessage(message, isError = false) {
            const container = document.querySelector('.max-w-5xl.mx-auto');
            let notificationDiv = container.querySelector('.notification-message');

            if (!notificationDiv) {
                notificationDiv = document.createElement('div');
                notificationDiv.className = `notification-message p-3 rounded-md mb-4 text-center text-sm absolute top-4 left-1/2 -translate-x-1/2 w-3/4 z-20 shadow-lg`;
                container.insertBefore(notificationDiv, container.firstChild);
            }

            notificationDiv.textContent = message;
            notificationDiv.classList.remove('notification-success', 'notification-error', 'hidden', 'show');
            notificationDiv.classList.add(isError ? 'notification-error' : 'notification-success');
            notificationDiv.classList.add('show');

            setTimeout(() => {
                notificationDiv.classList.remove('show');
                setTimeout(() => notificationDiv.classList.add('hidden'), 300);
            }, 3000);
        }

        /**
         * Menyimpan Kunci API Gemini ke localStorage.
         */
        function storeApiKeyLocally() {
            const apiKey = modalApiInputElem.value.trim();
            if (apiKey) {
                localStorage.setItem('geminiApiKey', apiKey);
                geminiApiModal.classList.remove('show');
                displayNotificationMessage('Kunci API Gemini berhasil disimpan.', false);
            } else {
                displayNotificationMessage('Kunci API Gemini tidak boleh kosong.', true);
            }
        }

        /**
         * Menghapus Kunci API Gemini dari localStorage.
         */
        function removeApiKeyLocally() {
            localStorage.removeItem('geminiApiKey');
            modalApiInputElem.value = '';
            displayNotificationMessage('Kunci API Gemini telah dihapus.', false);
        }

        /**
         * Mengatur status loading pada tombol dan spinner.
         * @param {boolean} isLoading - True untuk menampilkan loading, false untuk menyembunyikan.
         */
        function setLoadingState(isLoading) {
            if (isLoading) {
                generateBtnText.textContent = 'Membuat...';
                generateBtnSpinner.classList.remove('hidden');
                generateWorksheetBtn.disabled = true;
                resetFormBtn.disabled = true;
            } else {
                generateBtnText.textContent = 'Buat LKPD';
                generateBtnSpinner.classList.add('hidden');
                generateWorksheetBtn.disabled = false;
                resetFormBtn.disabled = false;
            }
        }

        /**
         * Mengambil data dari input form.
         * @returns {object} Objek berisi data LKPD.
         */
        function getLKPDData() {
            return {
                mataPelajaran: mataPelajaranInput.value.trim(),
                kelas: kelasInput.value.trim(),
                semester: semesterInput.value.trim(),
                materiPokok: materiPokokInput.value.trim(),
                namaGuru: namaGuruInput.value.trim(),
                tujuanPembelajaran: tujuanPembelajaranInput.value.trim().split('\n').filter(line => line.trim() !== ''),
                pengantarApersepsi: pengantarApersepsiInput.value.trim(),
                petunjukKerja: petunjukKerjaInput.value.trim().split('\n').filter(line => line.trim() !== ''),
                kegiatanIntiPrompt: kegiatanIntiPromptInput.value.trim(),
                pertanyaanInti: pertanyaanIntiInput.value.trim().split('\n').filter(line => line.trim() !== ''),
                refleksiSiswa: refleksiSiswaInput.value.trim().split('\n').filter(line => line.trim() !== ''),
                penilaianDiriPernyataan: penilaianDiriPernyataanInput.value.trim().split('\n').filter(line => line.trim() !== ''),
                kesimpulan: kesimpulanInput.value.trim(),
                tugasTambahan: tugasTambahanInput.value.trim(),
                ruangCatatan: ruangCatatanInput.value.trim() || 'Gunakan ruang ini untuk mencatat ide, pertanyaan, atau pemikiran lain terkait pembelajaran.'
            };
        }

        /**
         * Validasi input form.
         * @param {object} data - Data LKPD.
         * @returns {boolean} True jika semua input wajib terisi, false jika tidak.
         */
        function validateInputs(data) {
            const requiredInputs = [
                { id: 'mataPelajaran', value: data.mataPelajaran },
                { id: 'kelas', value: data.kelas },
                { id: 'semester', value: data.semester },
                { id: 'materiPokok', value: data.materiPokok },
                { id: 'namaGuru', value: data.namaGuru },
                { id: 'tujuanPembelajaran', value: data.tujuanPembelajaran },
                { id: 'pengantarApersepsi', value: data.pengantarApersepsi },
                { id: 'petunjukKerja', value: data.petunjukKerja },
                { id: 'kegiatanIntiPrompt', value: data.kegiatanIntiPrompt },
                { id: 'pertanyaanInti', value: data.pertanyaanInti },
                { id: 'refleksiSiswa', value: data.refleksiSiswa },
                { id: 'penilaianDiriPernyataan', value: data.penilaianDiriPernyataan },
                { id: 'kesimpulan', value: data.kesimpulan },
                { id: 'tugasTambahan', value: data.tugasTambahan }
            ];

            let allValid = true;
            requiredInputs.forEach(input => {
                const elem = document.getElementById(input.id);
                if (Array.isArray(input.value) ? input.value.length === 0 : !input.value) {
                    elem.classList.add('required-field');
                    allValid = false;
                } else {
                    elem.classList.remove('required-field');
                }
            });

            if (!allValid) {
                displayNotificationMessage('Harap lengkapi semua bidang yang ditandai dengan (*).', true);
            }
            return allValid;
        }

        /**
         * Membangun prompt untuk Gemini API berdasarkan data LKPD.
         * @param {object} data - Data LKPD.
         * @returns {string} Prompt yang diformat.
         */
        function buildGeminiPrompt(data) {
            const tujuanList = data.tujuanPembelajaran.map(item => `<li>${item.trim()}</li>`).join('\n');
            const petunjukList = data.petunjukKerja.map(item => `<li>${item.trim()}</li>`).join('\n');
            const pertanyaanList = data.pertanyaanInti.map((item, index) => `<li><strong>${index + 1}.</strong> ${item.trim()}
                <br><p class="text-sm text-gray-700 leading-tight">........................................................................................................................................................</p>
                <p class="text-sm text-gray-700 leading-tight">........................................................................................................................................................</p>
                </li>`).join('\n');
            const refleksiList = data.refleksiSiswa.map((item, index) => `<li><strong>${index + 1}.</strong> ${item.trim()}
                <br><p class="text-sm text-gray-700 leading-tight">........................................................................................................................................................</p>
                <p class="text-sm text-gray-700 leading-tight">........................................................................................................................................................</p>
                </li>`).join('\n');
            const penilaianTableRows = data.penilaianDiriPernyataan.map(item => `
                <tr>
                    <td class="border border-gray-300 p-2">${item.trim()}</td>
                    <td class="border border-gray-300 p-2 text-center">☐</td>
                    <td class="border border-gray-300 p-2 text-center">☐</td>
                </tr>`).join('\n');

            return `Hasilkan fragmen HTML untuk Lembar Kerja Peserta Didik (LKPD). Jangan sertakan tag HTML lengkap seperti <!DOCTYPE html>, <html>, <head>, atau <body>. HANYA hasilkan konten yang akan berada di dalam div 'worksheetOutputContainer', menggunakan kelas Tailwind CSS dan struktur gaya yang mirip dengan contoh yang Anda lihat sebelumnya. Pastikan untuk menyertakan ruang kosong untuk jawaban dan kotak centang untuk penilaian diri.

Berikut adalah detail LKPD:

<h1 class="text-xl font-bold text-center mb-4">LEMBAR KERJA PESERTA DIDIK</h1>
<hr>
<h2 class="text-lg font-semibold mt-6 mb-3 border-b border-gray-300 pb-1">Identitas LKPD</h2>
<div class="mb-4 text-base">
    <p><strong>Mata Pelajaran:</strong> ${data.mataPelajaran}</p>
    <p><strong>Kelas:</strong> ${data.kelas}</p>
    <p><strong>Semester:</strong> ${data.semester}</p>
    <p><strong>Materi Pokok:</strong> ${data.materiPokok}</p>
    <p><strong>Nama Guru:</strong> ${data.namaGuru}</p>
</div>
<hr>
<h2 class="text-lg font-semibold mt-6 mb-3 border-b border-gray-300 pb-1">Tujuan Pembelajaran</h2>
<ul class="list-disc list-inside mb-4 text-base leading-relaxed">
${tujuanList}
</ul>
<hr>
<h2 class="text-lg font-semibold mt-6 mb-3 border-b border-gray-300 pb-1">Pengantar / Apersepsi</h2>
<p class="mb-4 text-base leading-relaxed">${data.pengantarApersepsi}</p>
<hr>
<h2 class="text-lg font-semibold mt-6 mb-3 border-b border-gray-300 pb-1">Petunjuk Kerja</h2>
<ol class="list-decimal list-inside mb-4 text-base leading-relaxed">
${petunjukList}
</ol>
<hr>
<h2 class="text-lg font-semibold mt-6 mb-3 border-b border-gray-300 pb-1">Kegiatan Inti</h2>
<p class="mb-4 text-base leading-relaxed">${data.kegiatanIntiPrompt}</p>
<p class="text-sm text-gray-700 leading-tight">........................................................................................................................................................</p>
<p class="text-sm text-gray-700 leading-tight">........................................................................................................................................................</p>
<p class="text-sm text-gray-700 leading-tight">........................................................................................................................................................</p>
<p class="font-medium mb-2 text-base">Jawablah pertanyaan-pertanyaan berikut dengan berdiskusi:</p>
<ol class="list-decimal list-inside ml-4 mb-4 text-base leading-relaxed">
${pertanyaanList}
</ol>
<hr>
<h2 class="text-lg font-semibold mt-6 mb-3 border-b border-gray-300 pb-1">Refleksi Diri Siswa</h2>
<ul class="list-none mb-4 text-base leading-relaxed">
${refleksiList}
</ul>
<hr>
<h2 class="text-lg font-semibold mt-6 mb-3 border-b border-gray-300 pb-1">Penilaian Diri (Berikan tanda centang pada kolom yang sesuai)</h2>
<table class="w-full border-collapse border border-gray-400 mb-4 text-base">
    <thead>
        <tr>
            <th class="border border-gray-300 p-2 text-left bg-gray-100">Pernyataan</th>
            <th class="border border-gray-300 p-2 text-left bg-gray-100 text-center">Ya</th>
            <th class="border border-gray-300 p-2 text-left bg-gray-100 text-center">Tidak</th>
        </tr>
    </thead>
    <tbody>
${penilaianTableRows}
    </tbody>
</table>
<hr>
<h2 class="text-lg font-semibold mt-6 mb-3 border-b border-gray-300 pb-1">Kesimpulan & Tugas Tambahan</h2>
<p class="mb-4 text-base leading-relaxed">${data.kesimpulan}</p>
<p class="mb-4 text-base leading-relaxed"><strong>Tugas Tambahan:</strong> ${data.tugasTambahan}</p>
<hr>
<h2 class="text-lg font-semibold mt-6 mb-3 border-b border-gray-300 pb-1">Ruang Catatan Bebas Siswa</h2>
<p class="text-sm italic text-gray-600 mb-2">${data.ruangCatatan}</p>
<p class="text-sm text-gray-700 leading-tight">........................................................................................................................................................</p>
<p class="text-sm text-gray-700 leading-tight">........................................................................................................................................................</p>
<p class="text-sm text-gray-700 leading-tight">........................................................................................................................................................</p>
<p class="text-sm text-gray-700 leading-tight">........................................................................................................................................................</p>
<p class="text-sm text-gray-700 leading-tight">........................................................................................................................................................</p>
`;
        }

        /**
         * Memanggil Gemini API untuk menghasilkan LKPD.
         */
        async function generateWorksheet() {
            const apiKey = localStorage.getItem('geminiApiKey');
            if (!apiKey) {
                geminiApiModal.classList.add('show');
                displayNotificationMessage('Kunci API Gemini tidak ditemukan. Harap masukkan kunci Anda.', true);
                return;
            }

            const lkpdData = getLKPDData();
            if (!validateInputs(lkpdData)) {
                return; // Berhenti jika validasi gagal
            }

            setLoadingState(true);
            worksheetOutputContainer.innerHTML = `<p class="text-center text-gray-500 italic animate-pulse-light">Sedang membuat LKPD Anda, mohon tunggu...</p>`;

            const prompt = buildGeminiPrompt(lkpdData);

            try {
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const generatedHtml = result.candidates[0].content.parts[0].text;
                    worksheetOutputContainer.innerHTML = generatedHtml;
                    displayNotificationMessage('LKPD berhasil dibuat!', false);
                } else {
                    worksheetOutputContainer.innerHTML = `<p class="text-center text-red-600">Gagal membuat LKPD. Coba lagi atau periksa kunci API Anda.</p>`;
                    displayNotificationMessage('Respons API tidak valid.', true);
                }
            } catch (error) {
                console.error('Error fetching from Gemini API:', error);
                worksheetOutputContainer.innerHTML = `<p class="text-center text-red-600">Terjadi kesalahan saat menghubungi API: ${error.message}.</p>`;
                displayNotificationMessage('Terjadi kesalahan saat menghubungi API.', true);
            } finally {
                setLoadingState(false);
            }
        }

        /**
         * Mengatur ulang semua input formulir dan area output LKPD.
         */
        function resetForm() {
            mataPelajaranInput.value = 'IPA';
            kelasInput.value = 'VII';
            semesterInput.value = 'Genap';
            materiPokokInput.value = 'Sistem Tata Surya';
            namaGuruInput.value = 'Bpk. Budi Cahyadi, S.Pd.';
            tujuanPembelajaranInput.value = `Peserta didik dapat menjelaskan komponen-komponen sistem tata surya dengan benar.
Peserta didik mampu mengidentifikasi karakteristik masing-masing planet dalam tata surya.
Peserta didik dapat menganalisis interaksi antaranggota sistem tata surya.`;
            pengantarApersepsiInput.value = `Pernahkah kamu melihat bintang-bintang di malam malam? Atau mengamati perubahan bentuk bulan? Bagaimana semua benda langit itu bisa bergerak teratur di alam semesta ini?`;
            petunjukKerjaInput.value = `Bacalah materi tentang sistem tata surya dengan saksama dari berbagai sumber.
Diskusikan setiap pertanyaan dan tugas dengan kelompokmu.
Tuliskan jawaban dan hasil diskusimu pada kolom yang disediakan.
Periksa kembali jawabanmu sebelum dikumpulkan.`;
            kegiatanIntiPromptInput.value = `Bagian ini akan menguji pemahaman Anda tentang sistem tata surya.
Studi Kasus: Bayangkan Anda adalah seorang astronom yang baru saja menemukan sebuah objek langit misterius di luar orbit Neptunus. Berdasarkan pengamatan awal, objek ini memiliki massa yang sangat besar dan orbit yang tidak biasa. Jelaskan langkah-langkah investigasi yang akan Anda lakukan untuk mengklasifikasikan objek ini, serta tantangan apa yang mungkin Anda hadapi.`;
            pertanyaanIntiInput.value = `Bagaimana posisi bumi di tata surya memengaruhi kehidupan di dalamnya?
Mengapa Pluto tidak lagi diklasifikasikan sebagai planet? Jelaskan argumen ilmiah di baliknya.
Bandang dan jelaskan perbedaan antara komet dan asteroid dari segi komposisi, orbit, dan asal-usulnya.`;
            refleksiSiswaInput.value = `Apa yang saya pelajari hari ini tentang sistem tata surya?
Bagian mana dari materi sistem tata surya yang paling saya pahami atau yang paling sulit saya pahami?
Apa yang ingin saya tanyakan lebih lanjut terkait materi sistem tata surya ini?`;
            penilaianDiriPernyataanInput.value = `Saya dapat menjelaskan komponen-komponen sistem tata surya.
Saya mampu mengidentifikasi karakteristik setiap planet.
Saya dapat menganalisis interaksi antar anggota tata surya.`;
            kesimpulanInput.value = `Sistem tata surya adalah kumpulan benda langit yang terdiri dari matahari sebagai pusat, planet-planet, asteroid, komet, dan benda langit lainnya yang mengelilinginya dalam orbit masing-masing. Memahami tata surya membantu kita mengapresiasi kompleksitas dan keteraturan alam semesta.`;
            tugasTambahanInput.value = `Cari dan catatlah informasi menarik tentang salah satu penemuan terbaru di bidang astronomi terkait sistem tata surya, lalu presentasikan di kelas minggu depan.`;
            ruangCatatanInput.value = `Gunakan ruang ini untuk mencatat ide, pertanyaan, atau pemikiran lain terkait pembelajaran.`;

            // Hapus kelas 'required-field' dari semua input
            document.querySelectorAll('input, textarea').forEach(elem => {
                elem.classList.remove('required-field');
            });

            worksheetOutputContainer.innerHTML = `<p class="text-center text-gray-500 italic">Silakan isi formulir di atas dan klik "Buat LKPD" untuk menghasilkan lembar aktivitas.</p>`;
            displayNotificationMessage('Formulir berhasil direset.', false);
        }

        // Inisialisasi utama setelah DOM dimuat sepenuhnya
        document.addEventListener('DOMContentLoaded', () => {
            // Setup API modal and event listeners
            const storedApiKey = localStorage.getItem('geminiApiKey');
            if (!storedApiKey || storedApiKey.trim() === '') {
                geminiApiModal.classList.add('show');
            }
            modalApiInputElem.value = storedApiKey || '';

            saveApiBtn.addEventListener('click', storeApiKeyLocally);
            clearApiBtn.addEventListener('click', removeApiKeyLocally);
            closeApiModalBtn.addEventListener('click', () => {
                geminiApiModal.classList.remove('show');
            });
            settingsControlBtn.addEventListener('click', () => {
                geminiApiModal.classList.add('show');
                modalApiInputElem.value = localStorage.getItem('geminiApiKey') || '';
            });

            // Event listeners for worksheet generation and reset
            generateWorksheetBtn.addEventListener('click', generateWorksheet);
            resetFormBtn.addEventListener('click', resetForm);
            
            // Mengubah fungsi tombol cetak menjadi salin teks
            printWorksheetBtn.addEventListener('click', () => {
                const textToCopy = worksheetOutputContainer.innerText; // Mengambil teks dari elemen
                const tempTextArea = document.createElement('textarea');
                tempTextArea.value = textToCopy;
                document.body.appendChild(tempTextArea);
                tempTextArea.select();
                document.execCommand('copy'); // Menyalin teks ke papan klip
                document.body.removeChild(tempTextArea);
                displayNotificationMessage('Teks LKPD berhasil disalin ke papan klip!', false);
            });

            // Initial reset to populate default values and clear any previous state
            resetForm();
        });
    </script>
</body>
</html>
